{
  "discoveryModel": {
    "name": "CONOR ob-v3.0-ozone",
    "description": "An Open Banking UK discovery template for v3.0 of Accounts and Payments with pre-populated model Bank (Ozone) data.",
    "discoveryVersion": "v0.2.1",
    "tokenAcquisition": "psu",
    "discoveryItems": [],
    "customTests": [{
      "name": "CustomTest-GetOzoneToken",
      "description": "testcase sequence to retrieve an ozone token",
      "order": "beforeRun",
      "replacementParameters":{
        "client_id":"43909689-dd22-41fd-815e-47274ab77d87",
        "fapi_financial_id":"0015800001041RHAAY",
        "basic_authentication":"NDM5MDk2ODktZGQyMi00MWZkLTgxNWUtNDcyNzRhYjc3ZDg3Ojk2NjFlNzExLWE2YTEtNGQ0YS1iMzk5LTBjMmU2YWQ1MWE5Yw==",
        "token_endpoint":"https://modelobank2018.o3bank.co.uk:4201",
        "authorisation_endpoint":"https://modelobankauth2018.o3bank.co.uk:4101",
        "resource_server":"https://modelobank2018.o3bank.co.uk:4501",
        "redirect_url":"https://modelobankauth2018.o3bank.co.uk:4101/redirect-url",
        "permission_payload": "{\"Data\": {\"Permissions\": [\"ReadAccountsBasic\", \"ReadAccountsDetail\", \"ReadBalances\", \"ReadBeneficiariesBasic\", \"ReadBeneficiariesDetail\", \"ReadDirectDebits\", \"ReadTransactionsBasic\", \"ReadTransactionsCredits\", \"ReadTransactionsDebits\", \"ReadTransactionsDetail\", \"ReadProducts\", \"ReadStandingOrdersDetail\", \"ReadProducts\", \"ReadStandingOrdersDetail\"],\"TransactionFromDateTime\": \"2016-01-01T10:40:00+02:00\",\"TransactionToDateTime\": \"2025-12-31T10:40:00+02:00\"},\"Risk\": {}}"
      },
      "testSequence": [{
          "@id": "#ct0001",
          "name": "ClientCredential Grant",
          "input": {
            "method": "POST",
            "endpoint": "/token",
            "headers": {
              "content-type": "application/x-www-form-urlencoded",
              "accept": "*/*",
              "authorization": "Basic $basic_authentication"
            },
            "formData": {
              "grant_type": "client_credentials",
              "scope": "accounts openid"
            }
          },
          "context": {
            "baseurl": "$token_endpoint"
          },
          "expect": {
            "status-code": 200,
            "contextPut": {
              "matches": [{
                "name": "access_token",
                "description": "Access Token",
                "json": "access_token"
              }]
            }
          }
        },
        {
          "@id": "#ct0002",
          "name": "PostAccount Request",
          "input": {
            "method": "POST",
            "endpoint": "/open-banking/v3.0/aisp/account-access-consents",
            "headers": {
              "content-type": "application/json",
              "accept": "*/*",
              "x-fapi-interaction-id": "ccb07818-1fdb-47ea-a48e-73073b74f708",
              "x-fapi-financial-id": "$fapi_financial_id",
              "authorization": "Bearer $access_token"
            },
            "bodyData": "$permission_payload"
          },
          "context": {
            "baseurl": "$resource_server"
          },
          "expect": {
            "status-code": 201,
            "matches": [{
              "description": "Check we get Status:AwaitingAuthorisation",
              "json": "Data.Status",
              "value": "AwaitingAuthorisation"
            }],
            "contextPut": {
              "matches": [{
                "name": "consent_id",
                "description": "gets the consentid from PostAccountRequest ",
                "json": "Data.ConsentId"
              }]
            }
          }
        },
        {
          "@id": "#ct0003",
          "name": "Ozone PSU Consent Flow",
          "input": {
            "method": "GET",
            "endpoint": "/auth?clientid",
            "generation": {
              "strategy": "consenturl"
            },
            "claims": {
              "aud": "$authorisation_endpoint",
              "iss": "$client_id",
              "scope": "openid accounts",
              "redirect_url": "$redirect_url",
              "consentId": "$consent_id",
              "responseType": "code"
            }
          },
          "context": {
            "baseurl": "$authorisation_endpoint"
          },
          "expect": {
            "status-code": 302,
            "contextPut": {
              "matches": [{
                "name": "xchange_code",
                "description": "Get the xchange code from the location redirect header on hitting consent url for headless",
                "header": "Location",
                "regex": "code=(.*)&?.*"
              }]
            }
          }
        },
        {
          "@id": "#ct0004",
          "name": "code xchange",
          "input": {
            "method": "POST",
            "endpoint": "/token",
            "headers": {
              "content-type": "application/x-www-form-urlencoded",
              "authorization": "Basic $basic_authentication",
              "accept": "*/*"
            },
            "formData": {
              "code": "$xchange_code",
              "grant_type": "authorization_code",
              "redirect_uri": "$redirect_url",
              "scope": "accounts"
            }
          },
          "context": {
            "baseurl": "$token_endpoint"
          },
          "expect": {
            "status-code": 200,
            "contextPut": {
              "matches": [{
                "name": "access_token",
                "description": "The accounts access token",
                "json": "access_token"
              }]
            }
          }
        }
      ]
    }]
  }
}
